<!DOCTYPE html>
<html>
    <head>
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link rel="stylesheet" type="text/css" href="style.css">
    </head>
    <body>
        <div class='progress'></div>
        <div class="container">
            <h1>Create a Pitch</h1>
            <input class="inputText" type="text" id="title" placeholder="Pitch Title"><br>
            <textarea class="inputText" rows="10" cols="50" placeholder="Pitch Description"></textarea><br></br>
            <input class="inputText short" type="text" id="name" placeholder="Your Name"><br>
            <input class="inputText short" type="text" id="email" placeholder="Email"><br>
            <input class="inputText short" type="text" id="phone" placeholder="Phone Number"><br></br>
            <div class="check" href="#" data-clicked="0">#medtech</div>
            <div class="check" href="#" data-clicked="0">#hardware</div>
            <div class="check" href="#" data-clicked="0">#software</div>
            <div class="check" href="#" data-clicked="0">#globalhealth</div>
            <div class="check" href="#" data-clicked="0">#publichealth</div>
            <div class="check" href="#" data-clicked="0">#devices</div></br>
            <div class="error"></div>
            <button class="button" type="button">Submit</button>
        </div>
        <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
        <script type="text/javascript" src="http://www.parsecdn.com/js/parse-latest.js"></script>
        <script>
            Parse.initialize("vicmart-server");
            Parse.serverURL = "https://vicmart-server.herokuapp.com/";
            var Pitch = Parse.Object.extend("TestPitch");
            var prevLength = 0;
            var prog = 0;
            var alldone = [0, 0, 0, 0, 0, 0];
            var checks = 0;
            
            $(".check").click(function() {
                if ($(this).data("clicked") == 0) {
                    $(this).css("color", "rgba(25, 61, 86, 1)");
                    $(this).data("clicked", 1);
                    checks++;
                    if (alldone[5] == 0) {
                        alldone[5] = 1;
                        prog += 20;
                        $(".progress").css("width", prog + "%"); 
                        $(".progress").css("background-color", "rgba(25, 61, 86, 1)");
                    }
                } else  {
                    $(this).css("color", "rgba(25, 61, 86, 0.25)");
                    $(this).data("clicked", 0);
                    checks--;
                    if (checks == 0) {
                        alldone[5] = 0;
                        prog -= 20;
                        $(".progress").css("width", prog + "%");
                        $(".progress").css("background-color", "rgba(25, 61, 86, 1)");                        
                    }
                }
            });
            
            $(".inputText").keyup(function() {
                var index = $(".inputText").index(this);
                
                if (alldone[index] == 0 && $(this).val().length > 0) {
                    if ((index == 3 && alldone[4] == 0) || (index == 4 && alldone[3] == 0) || (index < 3 || index > 4)) {
                        prog += 20;
                        $(".progress").css("width", prog + "%"); 
                        $(".progress").css("background-color", "rgba(25, 61, 86, 1)");
                    } 
                    if (index != 1) {
                        $(this).addClass("inputTextGood");
                    } else {
                        $(this).addClass("inputTextGoodLarge");                        
                    }
                    alldone[index] = 1;
                } else if (alldone[index] == 1 && $(this).val().length == 0) {
                    if ((index == 3 && alldone[4] == 0) || (index == 4 && alldone[3] == 0) || (index < 3 || index > 4)) {
                        prog -= 20;
                        $(".progress").css("width", prog + "%"); 
                        $(".progress").css("background-color", "rgba(25, 61, 86, 1)");
                    } 
                    $(this).removeClass("inputTextGood");
                    $(this).removeClass("inputTextGoodLarge");
                    alldone[index] = 0;
                }
            });
            
            $(".button").click(function() {
                var title = $("#title").val();
                var description = $("textarea").val();
                var name = $("#name").val();
                var email = $("#email").val();
                var phone = $("#phone").val().replace(/\D/g, '');
                var checks = [];
                var oneCheck = false;    
                            
                $(".check").each(function(index) {
                    checks.push($(".check").eq(index).data("clicked")); 
                    if ($(".check").eq(index).data("clicked") == 1) {
                        oneCheck = true;
                    }
                });
                
                $(".error").text("");
                if (!title)  {
                    $(".error").text("Please enter a pitch title.");
                    $(".progress").css("background-color", "red");
                    return;
                } else if (!description) {
                    $(".error").text("Please enter a pitch description.");
                    $(".progress").css("background-color", "red");                    
                    return;
                } else if (!name) {
                    $(".error").text("Please enter your name.");
                    $(".progress").css("background-color", "red");
                    return;
                } else if (!email && !phone) {
                    $(".error").text("Please enter your email or phone number.");
                    $(".progress").css("background-color", "red");
                    return;
                } else if (!oneCheck) {
                    $(".error").text("Please select at least one catagory.");
                    $(".progress").css("background-color", "red");
                    return;                    
                }
                
                var savedPitch = new Pitch();
                savedPitch.set("title", title);
                savedPitch.set("description", description);
                savedPitch.set("name", name);
                savedPitch.set("email", email);
                savedPitch.set("phone", phone);
                savedPitch.set("checks", checks);
                
                savedPitch.save(null, {  
                    success: function(savedPitch) {
                        console.log('New object created with objectId: ' + savedPitch.id);
                        $(".button").text("Saved. Redirecting...");
                        setTimeout(function() {
                            location.replace("index.html");
                        }, 1500);
                    },
                    error: function(savedPitch, error) {
                        console.log('Failed to create new object, with error code: ' + error.message);
                    }
                });
            });
            
            /**$('#phone').on('keyup', function() {
                var length = $(this).val().length;
                var text = $(this).val();
                if (length >= prevLength && (length == 3 || length == 7)) {
                    $(this).val(text + "-");
                } else if (length < prevLength && (length == 4 || length == 8)) {
                    $(this).val(text.substring(0, text.length - 1));                    
                }
                prevLength = length;
            });**/
        </script>
    </body>
</html>

